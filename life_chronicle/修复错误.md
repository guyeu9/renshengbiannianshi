Run flutter test

../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/src/amap_api_key.dart:47:23: Error: The method 'hashValues' isn't defined for the type 'AMapApiKey'.
 - 'AMapApiKey' is from 'package:amap_flutter_base/amap_flutter_base.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/amap_flutter_base.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(androidKey, iosKey);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/src/location.dart:112:7: Error: The method 'hashValues' isn't defined for the type 'AMapLocation'.
 - 'AMapLocation' is from 'package:amap_flutter_base/amap_flutter_base.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/amap_flutter_base.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
      hashValues(provider, latLng, accuracy, altitude, bearing, speed, time);
      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/src/location.dart:154:23: Error: The method 'hashValues' isn't defined for the type 'LatLng'.
 - 'LatLng' is from 'package:amap_flutter_base/amap_flutter_base.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/amap_flutter_base.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(latitude, longitude);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/src/location.dart:229:23: Error: The method 'hashValues' isn't defined for the type 'LatLngBounds'.
 - 'LatLngBounds' is from 'package:amap_flutter_base/amap_flutter_base.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/amap_flutter_base.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(southwest, northeast);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/src/amap_privacy_statement.dart:50:23: Error: The method 'hashValues' isn't defined for the type 'AMapPrivacyStatement'.
 - 'AMapPrivacyStatement' is from 'package:amap_flutter_base/amap_flutter_base.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0/lib/amap_flutter_base.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(hasContains, hasShow, hasAgree);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/camera.dart:69:23: Error: The method 'hashValues' isn't defined for the type 'CameraPosition'.
 - 'CameraPosition' is from 'package:amap_flutter_map/src/types/camera.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/camera.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(bearing, target, tilt, zoom);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/ui.dart:91:23: Error: The method 'hashValues' isn't defined for the type 'MinMaxZoomPreference'.
 - 'MinMaxZoomPreference' is from 'package:amap_flutter_map/src/types/ui.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/ui.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(minZoom, maxZoom);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/ui.dart:187:7: Error: The method 'hashValues' isn't defined for the type 'MyLocationStyleOptions'.
 - 'MyLocationStyleOptions' is from 'package:amap_flutter_map/src/types/ui.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/ui.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
      hashValues(enabled, circleFillColor, circleStrokeColor, icon);
      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/ui.dart:244:23: Error: The method 'hashValues' isn't defined for the type 'CustomStyleOptions'.
 - 'CustomStyleOptions' is from 'package:amap_flutter_map/src/types/ui.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/ui.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(enabled, styleData, styleExtraData);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/marker.dart:71:23: Error: The method 'hashValues' isn't defined for the type 'InfoWindow'.
 - 'InfoWindow' is from 'package:amap_flutter_map/src/types/marker.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/marker.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
  int get hashCode => hashValues(title, snippet);
                      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/marker_updates.dart:94:7: Error: The method 'hashValues' isn't defined for the type 'MarkerUpdates'.
 - 'MarkerUpdates' is from 'package:amap_flutter_map/src/types/marker_updates.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/marker_updates.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
      hashValues(markersToAdd, markerIdsToRemove, markersToChange);
      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/polyline_updates.dart:99:7: Error: The method 'hashValues' isn't defined for the type 'PolylineUpdates'.
 - 'PolylineUpdates' is from 'package:amap_flutter_map/src/types/polyline_updates.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/polyline_updates.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
      hashValues(polylinesToAdd, polylineIdsToRemove, polylinesToChange);
      ^^^^^^^^^^
../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/polygon_updates.dart:97:7: Error: The method 'hashValues' isn't defined for the type 'PolygonUpdates'.
 - 'PolygonUpdates' is from 'package:amap_flutter_map/src/types/polygon_updates.dart' ('../../../../.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0/lib/src/types/polygon_updates.dart').
Try correcting the name to the name of an existing method, or defining a method named 'hashValues'.
      hashValues(polygonsToAdd, polygonIdsToRemove, polygonsToChange);
      ^^^^^^^^^^
âŒ loading /home/runner/work/renshengbiannianshi/renshengbiannianshi/life_chronicle/test/widget_test.dart (failed)

Error: 0 tests passed, 1 failed.
Error: Process completed with exit code 1.



<details type="reasoning" done="true" duration="60">
<summary>Thought for 60 seconds</summary>
&gt; The error is clear: `hashValues` was removed in Flutter 3.x (Dart 2.17+). It was deprecated and then removed. The `amap_flutter_base-3.0.0` and `amap_flutter_map-3.0.0` packages still use the old `hashValues()` function which no longer exists in newer versions of Flutter/Dart.
&gt; 
&gt; The fix options are:
&gt; 
&gt; 1. Use a newer version of `amap_flutter_base` and `amap_flutter_map` that have fixed this issue
&gt; 2. Since these are pub-cached packages and we can&#x27;t modify them directly, we need to either:
&gt;    - Use `dependency_overrides` in pubspec.yaml to point to a patched version
&gt;    - Fork the packages and fix them
&gt;    - Use `patch` files with a tool like `patch_pubspec`
&gt; 
&gt; My best approach is to first check if there are newer versions of these packages that already address this, and if not, use `dependency_overrides` with a git reference to a patched version or `pubspec_overrides.yaml`. The `hashValues` function was removed in Flutter 3.4 (deprecated in 3.0), so I&#x27;d need to replace it with `Object.hash()` instead.
&gt; 
&gt; Since these are third-party packages from pub.dev that I can&#x27;t modify directly, I should check if `amap_flutter_base` and `amap_flutter_map` have newer versions available that fix this issue. If they don&#x27;t, the practical solution for CI/CD would be using `dependency_overrides` to point to a patched git repository or local path override. Solution 1 isn&#x27;t practical since downgrading Flutter defeats the purpose. Solutions 2 and 3 both involve using `dependency_overrides` to point to patched versionsâ€”either via git or local pathsâ€”which would require maintaining fixed copies of these packages. Solution 4, patching the pub cache directly in CI, might be cleaner if I can write a script that modifies the cached files before tests run.
&gt; 
&gt; For the most straightforward approach in CI, I could create local package overrides in the project and use `dependency_overrides` in `pubspec.yaml`, or leverage `pubspec_overrides.yaml` if on Flutter 3.2+. The actual fix is straightforward: replace all `hashValues()` calls with `Object.hash()` to match the newer Dart API. I&#x27;m setting up the dependency overrides configuration to point to local patched copies of the amap packages, which will work reliably in CI since they&#x27;re committed to the repository. The core issue is that `hashValues` was removed from Flutter&#x27;s API, so I need to walk through the root cause, show the actual fix for replacing it with `Object.hash()`, and give concrete implementation steps for applying these patches locally. `hashValues()` needs to be replaced with `Object.hash()` across both packages, taking the same arguments since `Object.hash()` supports up to 20 parameters. The cleanest approach is to create local package directories and apply these fixes there, then add dependency overrides to pubspec.yaml to point to them instead of relying on pub cache modifications. The issue is that some `hashValues` calls span multiple lines, so a simple sed replacement won&#x27;t workâ€”I need a more sophisticated approach like a Python script or just copying the packages locally. I&#x27;m leaning toward a setup script that pulls packages from the pub cache, applies patches, and stores them locally without committing the entire package contents. practical and maintainable solution:
&gt; 
&gt; ## Final Recommendation
&gt; 
&gt; **The cleanest solution**: Use `dependency_overrides` with patched local copies of the two packages. The user should:
&gt; 
&gt; 1. Create `packages/amap_flutter_base/` and `packages/amap_flutter_map/` directories
&gt; 2. Copy the package contents from pub cache
&gt; 3. Fix the `hashValues` â†’ `Object.hash()` calls
&gt; 4. Add `dependency_overrides` in `pubspec.yaml`
&gt; 
&gt; I&#x27;ll provide:
&gt; - The exact changes needed per file
&gt; - The pubspec.yaml changes
&gt; - A setup script that automates the copy+patch process
&gt; 
&gt; This way it works in CI without any extra steps beyond `flutter pub get`.
&gt; 
&gt; Let me write this up properly.
&gt; 
&gt; Actually, I realize I should also consider: maybe there&#x27;s a newer version of these packages that fixes this. Let me check my knowledge:
&gt; 
&gt; Both `amap_flutter_map` and `amap_flutter_base` are stuck at version 3.0.0 from around 2022 and haven&#x27;t been maintained since, so they don&#x27;t support Dart 3 or Flutter 3.10+. There&#x27;s no newer version to upgrade to, so patching locally is the only viable path forward.
&gt; 
&gt; Now I&#x27;ll put together a comprehensive answer covering the root cause, a setup script to automate the patching, the exact code changes needed, the pubspec.yaml configuration, and how to update the CI workflow to make this work seamlessly. to be replaced with `Object.hash(...)` throughout the codebase. The replacement is straightforwardâ€”just swap `hashValues(` for `Object.hash(` while keeping all the arguments intact, whether they&#x27;re on a single line or spread across multiple lines.
&gt; 
&gt; Looking at the actual instances across the files, they&#x27;re all single-line calls that are just indented differently, so a simple sed replacement should handle them all at once. Let me verify this works for the various patterns I&#x27;m seeing...
&gt; 
&gt; Checking the replacement... I&#x27;ve identified two approaches to fix this: I could patch the pub cache directly in CI with a simple sed replacement, which is the fastest solution, or I could create local package overrides with the fix already applied for better reproducibility across environments.
&gt; 
&gt; The core issue is that both the Dart compilation failure in tests and the earlier Gradle error stem from the same incompatibilityâ€”these amap packages use the deprecated `hashValues()` function that was removed in the current Dart SDK, so I need to address that root cause rather than treating the symptoms separately.
</details>
# æ ¹æœ¬åŸå› 

`hashValues()` åœ¨ **Flutter 3.x / Dart 2.17+** ä¸­è¢«å½»åº•ç§»é™¤ï¼Œæ›¿ä»£å“æ˜¯ `Object.hash()`ã€‚`amap_flutter_base:3.0.0` å’Œ `amap_flutter_map:3.0.0` å®˜æ–¹é•¿æœŸæœªç»´æŠ¤ï¼Œä¸¤ä¸ªåŒ…å†…å…± 13 å¤„è°ƒç”¨äº†å·²åˆ é™¤çš„ APIï¼Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚

---

## å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆäºŒï¼šæœ¬åœ° package overrideï¼ˆæ›´ç¨³å®šï¼Œæäº¤åˆ°ä»“åº“ï¼‰

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¿®å¤è„šæœ¬

```bash
# scripts/patch_amap.sh
#!/bin/bash
set -e

BASE_SRC="$HOME/.pub-cache/hosted/pub.dev/amap_flutter_base-3.0.0"
MAP_SRC="$HOME/.pub-cache/hosted/pub.dev/amap_flutter_map-3.0.0"
LOCAL="$(dirname "$0")/../packages"

echo "ğŸ“¦ å¤åˆ¶ amap_flutter_base..."
rm -rf "$LOCAL/amap_flutter_base"
cp -r "$BASE_SRC" "$LOCAL/amap_flutter_base"

echo "ğŸ“¦ å¤åˆ¶ amap_flutter_map..."
rm -rf "$LOCAL/amap_flutter_map"
cp -r "$MAP_SRC" "$LOCAL/amap_flutter_map"

echo "ğŸ”§ ä¿®å¤ hashValues..."
find "$LOCAL" -name "*.dart" \
  -exec sed -i 's/hashValues(/Object.hash(/g' {} \;

echo "âœ… å®Œæˆ"
```

```bash
chmod +x scripts/patch_amap.sh
./scripts/patch_amap.sh
```

#### ç¬¬äºŒæ­¥ï¼šéœ€è¦æ‰‹åŠ¨ä¿®æ”¹çš„æ‰€æœ‰æ–‡ä»¶æ¸…å•

ä¿®å¤ç‚¹éå¸¸æ˜ç¡®ï¼Œå…¨éƒ¨æ˜¯ **`hashValues(` â†’ `Object.hash(`**ï¼Œå…± 13 å¤„ï¼š

**`packages/amap_flutter_base/lib/src/amap_api_key.dart`**
```dart
// âŒ ä¿®å¤å‰
int get hashCode => hashValues(androidKey, iosKey);

// âœ… ä¿®å¤å
int get hashCode => Object.hash(androidKey, iosKey);
```

**`packages/amap_flutter_base/lib/src/amap_privacy_statement.dart`**
```dart
// âŒ ä¿®å¤å‰
int get hashCode => hashValues(hasContains, hasShow, hasAgree);

// âœ… ä¿®å¤å
int get hashCode => Object.hash(hasContains, hasShow, hasAgree);
```

**`packages/amap_flutter_base/lib/src/location.dart`**ï¼ˆ3å¤„ï¼‰
```dart
// âŒ ä¿®å¤å‰
int get hashCode => hashValues(latitude, longitude);
int get hashCode => hashValues(southwest, northeast);
hashValues(provider, latLng, accuracy, altitude, bearing, speed, time);

// âœ… ä¿®å¤å
int get hashCode => Object.hash(latitude, longitude);
int get hashCode => Object.hash(southwest, northeast);
Object.hash(provider, latLng, accuracy, altitude, bearing, speed, time);
```

**`packages/amap_flutter_map/lib/src/types/camera.dart`**
```dart
// âŒ â†’ âœ…
int get hashCode => Object.hash(bearing, target, tilt, zoom);
```

**`packages/amap_flutter_map/lib/src/types/ui.dart`**ï¼ˆ3å¤„ï¼‰
```dart
// âŒ â†’ âœ…
int get hashCode => Object.hash(minZoom, maxZoom);
Object.hash(enabled, circleFillColor, circleStrokeColor, icon);
int get hashCode => Object.hash(enabled, styleData, styleExtraData);
```

**`packages/amap_flutter_map/lib/src/types/marker.dart`**
```dart
// âŒ â†’ âœ…
int get hashCode => Object.hash(title, snippet);
```

**`packages/amap_flutter_map/lib/src/types/marker_updates.dart`**
```dart
// âŒ â†’ âœ…
Object.hash(markersToAdd, markerIdsToRemove, markersToChange);
```

**`packages/amap_flutter_map/lib/src/types/polyline_updates.dart`**
```dart
// âŒ â†’ âœ…
Object.hash(polylinesToAdd, polylineIdsToRemove, polylinesToChange);
```

**`packages/amap_flutter_map/lib/src/types/polygon_updates.dart`**
```dart
// âŒ â†’ âœ…
Object.hash(polygonsToAdd, polygonIdsToRemove, polygonsToChange);
```

#### ç¬¬ä¸‰æ­¥ï¼špubspec.yaml æ·»åŠ  dependency_overrides

```yaml
# pubspec.yaml
dependencies:
  amap_flutter_base: ^3.0.0
  amap_flutter_map: ^3.0.0
  # ... å…¶ä»–ä¾èµ–

dependency_overrides:
  amap_flutter_base:
    path: packages/amap_flutter_base   # ä½¿ç”¨æœ¬åœ°ä¿®å¤ç‰ˆæœ¬
  amap_flutter_map:
    path: packages/amap_flutter_map    # ä½¿ç”¨æœ¬åœ°ä¿®å¤ç‰ˆæœ¬
```

#### ç¬¬å››æ­¥ï¼šæ›´æ–° .gitignoreï¼Œç¡®ä¿æäº¤æœ¬åœ°åŒ…

```gitignore
# .gitignore - ç¡®ä¿è¿™ä¸¤è¡Œä¸å­˜åœ¨æˆ–è¢«æ³¨é‡Š
# packages/
```

```bash
git add packages/ pubspec.yaml pubspec.lock
git commit -m "fix: patch amap packages for Dart 3 compatibility (hashValuesâ†’Object.hash)"
```

---

## é—®é¢˜æ ¹å› æ€»ç»“

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| ç§»é™¤çš„ API | `hashValues()` (æ¥è‡ª `dart:ui`) |
| ç§»é™¤ç‰ˆæœ¬ | Flutter 3.0 åºŸå¼ƒ / Flutter 3.4+ å½»åº•ç§»é™¤ |
| å½±å“åŒ… | `amap_flutter_base:3.0.0` / `amap_flutter_map:3.0.0` |
| æŠ¥é”™æ•°é‡ | å…± 13 å¤„ |
| æ›¿ä»£ API | `Object.hash(a, b, ...)` (â‰¤20å‚æ•°) æˆ– `Object.hashAll([...])` |
| å®˜æ–¹ç»´æŠ¤çŠ¶æ€ | âš ï¸ å·²åœæ­¢æ›´æ–°ï¼Œéœ€è‡ªè¡Œç»´æŠ¤æœ¬åœ°è¡¥ä¸ |

**æ¨èåšæ³•**ï¼šæ–¹æ¡ˆäºŒï¼ˆæœ¬åœ° overrideï¼‰ä¸€æ¬¡ä¿®å¤æ°¸ä¹…ç”Ÿæ•ˆï¼ŒCI å’Œæœ¬åœ°å¼€å‘å‡æ— éœ€é¢å¤–æ­¥éª¤ã€‚

---

## æ”¹è¿›æ–¹æ¡ˆè½å®è®°å½•ï¼ˆæœ¬åœ° override å·²åº”ç”¨ï¼‰

ä¸ºå½»åº•è§£å†³ CI ä¸­æ¥è‡ª pub ç¼“å­˜æ—§ç‰ˆæ’ä»¶çš„ `hashValues` ç¼–è¯‘é”™è¯¯ï¼Œæœ¬ä»“åº“é‡‡ç”¨æœ¬åœ°æ’ä»¶è¦†ç›–æ–¹æ¡ˆå¹¶å·²è½åœ°ï¼š

- å·²å†…ç½®å¹¶ä¿®å¤æ’ä»¶æºç 
  - ç›®å½•ï¼š`life_chronicle/plugins/amap_flutter_base`ã€`life_chronicle/plugins/amap_flutter_map`
  - ç»Ÿä¸€å°†æ‰€æœ‰ `hashValues(` æ›¿æ¢ä¸º `Object.hash(`ï¼Œç¡®ä¿å…¼å®¹ Dart 3/Flutter 3.x
- å·²åœ¨ `pubspec.yaml` å¢åŠ  overridesï¼Œå¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ’ä»¶

å˜æ›´è¦ç‚¹

- æ·»åŠ å†…å®¹ï¼š

```yaml
dependency_overrides:
  amap_flutter_base:
    path: plugins/amap_flutter_base
  amap_flutter_map:
    path: plugins/amap_flutter_map
```

éªŒè¯æ–¹æ³•

1. æ‰§è¡Œ `flutter pub get`ï¼Œç¡®è®¤ä¾èµ–æŒ‡å‘æœ¬åœ°æ’ä»¶ç›®å½•
2. æ‰§è¡Œ `flutter test`ï¼Œåº”ä¸å†æŠ¥ `hashValues` ç›¸å…³é”™è¯¯

æ³¨æ„äº‹é¡¹

- ä¸å†ä¾èµ– pub.dev ä¸Šçš„ `amap_flutter_base:3.0.0` ä¸ `amap_flutter_map:3.0.0`ï¼Œé¿å… CI æ‹‰å–æœªä¿®å¤ç‰ˆæœ¬
- å¦‚éœ€åŒæ­¥ä¸Šæ¸¸æ”¹åŠ¨ï¼Œä¼˜å…ˆåœ¨æœ¬åœ°æ’ä»¶ä¸­åˆå¹¶å¹¶éªŒè¯ï¼Œå†æäº¤ä»“åº“
