## 2026-02-20

- 小确幸详情页重构：
  - **UI 布局优化**：调整为“标题 -> 描述 -> 标签 -> 地理位置 -> 发布时间 -> 图片 -> 万物互联”的纵向流式布局，去除顶部标题栏冗余文字。
  - **多图动态展示**：支持单图大图、双图并排、三图拼贴、四图及以上九宫格的自适应布局；点击图片支持手势缩放查看大图。
  - **底部操作栏**：新增底部菜单栏，包含“编辑”（跳转编辑页）、“收藏”（实时切换状态）、“分享”（生成长图分享）三个核心入口。
  - **级联删除**：实现详情页删除功能，删除小确幸记录时自动清理 `entity_links` 表中的所有关联数据，防止数据残留。
  - **长图分享**：利用 `RepaintBoundary` 和 `share_plus` 实现详情页内容生成长图并调用系统分享。

- 界面图片刷新与输入焦点优化：本地图片渲染改用 `Image.file` 并开启 `gaplessPlayback`，避免收藏切换等操作导致整页图片重新解码闪烁；详情页与筛选等操作按钮统一 `unfocus` 清理输入焦点，避免键盘自动弹出：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)、[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)、[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)、[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)、[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- Android release 构建修复：为 `amap_flutter_map` 补充 `namespace`，兼容新版 AGP 构建要求，解决 `assembleRelease` 报错：[build.gradle](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/plugins/amap_flutter_map/android/build.gradle)

- 删除策略调整：小确幸删除改为硬删除（直接删除 `moment_records` + 对应 `timeline_events`），并保持删除前清理 `entity_links`，避免软删除残留导致“万物互联”脏引用：[moment_dao.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/daos/moment_dao.dart)、[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
- 羁绊朋友档案补齐关联小确幸：朋友档案“共同回忆轴”以 `entity_links(friend↔*)` 聚合回忆，确保关联小确幸在档案中可见：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- Android 构建修复：移除 `com.amap.api:location` 依赖，避免与 `com.amap.api:3dmap` 产生重复类冲突（`checkReleaseDuplicateClasses`）：[build.gradle.kts](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/android/app/build.gradle.kts)
- 工程分析基线修复：`analysis_options.yaml` 排除 `_toolchain/`、`windows_bak/` 与本地 `plugins/`，恢复 `flutter analyze` 可用：[analysis_options.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/analysis_options.yaml)
- 地图插件本地化清理：移除 `amap_flutter_map` 文档与冗余元数据文件，仅保留构建所需的 `lib/android/ios` 目录，降低未提交文件数量：[amap_flutter_map](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/plugins/amap_flutter_map)、[amap_flutter_base](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/plugins/amap_flutter_base)
- 依赖告警收敛：升级 `share_plus` / `flutter_lints` / `sqlite3_flutter_libs` 到可解析的较新版本，减少 `flutter pub get` 的“新版本不兼容约束”提示：[pubspec.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/pubspec.yaml)

- 数据库架构优化：移除旧数据库文件兼容迁移逻辑，统一使用 `life_chronicle.sqlite`，版本升级至 v6 以强制检查和修复缺失字段；
- 修复数据保存问题：通过版本升级触发全量 Schema 检查，确保所有位置相关字段（poiName/poiAddress/latitude/longitude）正确添加。
- 相遇地点统一接入高德地点组件并规范化落库：新建相遇的“地点”改为跳转 [amap_location_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/widgets/amap_location_page.dart) 选择/手动填写，保存写入 `timeline_events.poi_name/poi_address/latitude/longitude`；朋友档案“共同回忆轴”地点支持点击进入地图预览并外部导航：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 旅行地点与首页日程联动补齐：旅行新建页地点选择统一改用高德组件，并在保存旅行记录时同步 upsert `timeline_events(eventType=travel)`（含 poiName/poiAddress/经纬度），便于首页日程按日期聚合展示：[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
- 工程清理：移除美食页内重复地图页面实现与无用依赖引入，修正数据库迁移中重复 addColumn（food 纬度/经度）：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[app_database.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/app_database.dart)
- 修复相遇列表/详情页数据源不一致导致无法展示地点与参与者：相遇 Tab 时间线改为直接读取 `timeline_events(eventType=encounter)` 并从 `entity_links(encounter↔friend)` 渲染参与者头像；相遇详情页改为按 encounterId 实时读取 `timeline_events`，地点支持点击进入高德地图预览并外部导航，万物互联计数按 `entity_links` 动态渲染：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 地点编辑入口彻底统一：移除美食新建页地点卡长按弹窗手动输入，地点编辑统一收敛到高德地点组件（搜索/手动填写/外部导航），避免多套入口导致字段不一致：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[amap_location_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/widgets/amap_location_page.dart)
- 美食主页筛选增强：搜索框下方 4 个筛选 Chips（日期范围/评分/位置城市/同伴）改为分别弹出对应筛选弹窗，支持复合筛选；当某项已筛选时该 Chip 变为淡蓝色；位置城市列表仅显示已落库的城市（从已有地点地址解析得到）；同伴弹窗包含羁绊朋友与“独享(无关联朋友)”选项：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
- 修复“无法新建保存/历史数据看似丢失”：数据库升级迁移补齐缺失表与缺失列的兜底创建（`timeline_events/entity_links/link_logs` 等），避免升级后写入/查询直接崩溃；并在 iOS/Android 本地连接时兼容旧数据库文件名迁移到 `life_chronicle.sqlite`，确保旧数据可继续读取：[app_database.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/app_database.dart)、[db_connection_io.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/db_connection_io.dart)
- 个人中心新增“个人资料”设置页：入口插入到“万物互联”和“提醒设置”之间，支持编辑用户名/出生日期/身高体重/感情状态；个人资料改为落库到 Drift 新表 `user_profiles(id='me')`，并同步个人中心头像下方与首页日程左上角展示，确保统一：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)、[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)、[database_providers.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/database_providers.dart)、[tables.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/tables.dart)、[app_database.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/app_database.dart)
- Android 包名调整：将 `applicationId/namespace` 更新为 `com.suliuzhe.lifechronicle` 并迁移 MainActivity 包路径，确保 APK 包名一致：[build.gradle.kts](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/android/app/build.gradle.kts)、[MainActivity.kt](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/android/app/src/main/kotlin/com/suliuzhe/lifechronicle/MainActivity.kt)

- 美食心愿清单详情页对齐（复用美食详情页但按心愿清单重排）：
  - **中部文案与结构**：将中间文本改为“心愿备注”区块，并拆分“美食标签/打卡相册/万物关联”分区展示，符合心愿清单信息结构：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
  - **底部按钮改造**：心愿清单底部改为“编辑 / 分享 / 标记为已品尝”，其中分享为生成长图分享
  - **标记已品尝流转**：点击“标记为已品尝”进入美食编辑发布页，自动取消“加入心愿清单”并标记已品尝；保存发布后自动回到美食列表并从心愿清单移除（由 `isWishlist` 状态切换实现）

- 点击地理位置闪退（Android 15）修复：
  - **根因**：`amap_flutter` 内部 native 库 `libAMapOpenMap.so` 在 Android 15 上触发 JNI `GetStaticMethodID(java.lang.Runtime.nativeLoad)` 失败，导致进程直接 abort，无法在 Dart 层捕获
  - **策略**：替换为 `amap_flutter_map` 原生插件并本地修复 Flutter 3 的 `hashValues` 兼容问题，恢复 Android 15+ 内嵌原生地图体验（实时定位、拖动地图选择、POI 点击）
  - **实现**：新增本地补丁脚本同步修复 `amap_flutter_map/amap_flutter_base`，依赖改为本地路径并加依赖覆盖；地点页改用 `AMapWidget`，启用合规声明与定位小蓝点，地图拖动后同步坐标：[amap_location_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/widgets/amap_location_page.dart)、[pubspec.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/pubspec.yaml)、[patch_amap_plugin.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/patch_amap_plugin.dart)

## 2026-02-19

- 小确幸详情页原型对齐：标题/正文上置、心情标识、标签与多图自适应展示、图片下方日期地点、分享长图预览与编辑/收藏/分享/删除入口（删除提示同步清理万物互联关联）：[code.html](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/%E5%89%8D%E7%AB%AF/stitch_home_schedule_dashboard/3-2%20%E5%B0%8F%E7%A1%AE%E5%B9%B8-%E8%AF%A6%E6%83%85%E9%A1%B5/code.html)
- 小确幸功能完善：详情页新增编辑入口并复用新建页预填；地理位置改为高德地图选择/预览；列表读取本地数据库；发布/编辑同步写入首页日程 `timeline_events` 并更新万物互联关联：[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
- 羁绊共同回忆列表卡片样式优化：根据图片数量自适应展示（无图/单图/多图），多图支持九宫格预览（最多9张）与剩余数量提示：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 羁绊共同回忆列表性能优化：重构为 `SliverList` 实现虚拟列表渲染，解决长列表性能问题：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 羁绊朋友档案改为读取 friend_records 实际数据，支持新建落库、头像本地/首字母回退、标签解析与相识天数/上次见面计算，详情同步展示生日/认识途径/备注/联络频率：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 羁绊朋友档案列表交互完善：搜索框支持输入搜索（姓名/备注/标签等），筛选按钮弹出底部筛选（日期范围/按朋友勾选），收藏档案在列表优先置顶；列表与搜索框之间空白收敛：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 羁绊档案详情页补齐操作：编辑档案按钮跳转到编辑页面（复用新建档案页），右上角“⋮”弹出删除档案入口；删除时同时清理 entity_links 关联，避免万物互联引用残留导致报错：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)、[friend_dao.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/daos/friend_dao.dart)
- 羁绊新建朋友档案补齐中文日期+时间选择与头像持久化，联络频率默认“无需提醒”并支持“每一个月/每三个月/每年”写入档案：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 相遇记录时间写入精确到时分，日期选择统一中文化：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 日期选择中文化覆盖小确幸记录时间与筛选、美食/旅行筛选日期范围：[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)、[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
- 个人头像改为本地持久化并同步首页日程顶部头像读取，避免更换后返回清空：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)、[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 修复首页日程分析告警：移除未使用的 `intl/table_calendar` 引入、修正 AppTheme 引用路径并引入 `appDatabaseProvider`，恢复日程页可正常分析与编译：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)、[pubspec.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/pubspec.yaml)
- 美食/小确幸/旅行/相遇图片选取后复制到应用沙盒目录并存储本地路径，旅行新增封面上传入口并保存封面路径：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)、[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)、[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 图片持久化统一封装为全局工具，覆盖头像/相遇/旅行/美食/小确幸存储，避免系统清理缓存导致本地图片丢失：[media_storage.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/utils/media_storage.dart)、[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)、[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)、[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)、[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
- 人生传记卡片接入实时统计并补齐相遇/目标计数展示：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 美食详情页对齐 `2-3 美食详情页` 原型并补齐底部菜单功能：编辑复用新建页、收藏写入 is_favorite、分享导出长图、再次打卡预填餐厅名/地点/人均消费，新增瀑布图墙与地图提示样式：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
- 收藏中心改为仅展示详情页标记收藏的数据，并补齐 food/moment/travel/friend 统一收藏字段 is_favorite（含 schemaVersion=4 迁移）：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)、[tables.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/tables.dart)、[app_database.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/app_database.dart)
- 收藏中心补齐概览统计、分类筛选与选择模式批量操作入口（全选/批量导出/删除），并让收藏卡片支持选择态交互：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 收藏中心接入本地数据库真实数据源，基于 food_records / travel_records / moment_records / friend_records 生成分类与卡片内容，按记录时间倒序展示并兼容本地图片路径：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 首页日程顶部头像：从个人中心返回后主动刷新本地头像读取结果，避免头像更新后首页仍显示旧头像：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 收藏中心：收藏概览新增“相遇”统计占位卡片，并在分类栏补齐“相遇”分类入口（当前无数据，计数为 0）：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 美食主页改为读取 `food_records` 真实数据源：新建记录可立即出现在列表；搜索与筛选 Chips 支持点击并按关键词/日期范围/关联朋友过滤（心愿清单同样接入真实数据）：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
- 首页日程接入美食记录展示：补齐 `food` 事件类型的图标/颜色映射，并基于 `record_date` 显示当日美食记录：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 羁绊-新建朋友档案按 `6-5 羁绊-新建朋友档案` 原型重排：顶部栏、头像区、信息卡（姓名/生日/认识日期/认识途径）、联络频率弹窗、备注与标签交互：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 修复日期/时间选择弹窗无法加载：补齐 `flutter_localizations` 依赖并在 `MaterialApp` 配置本地化委托与支持语言（`zh-CN`/`en-US`）：[pubspec.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/pubspec.yaml)、[app.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/app/app.dart)
- 羁绊-朋友档案详情页“备注/联络频率”改为左对齐，避免信息块居中偏移：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 工程清理：移除未引用的私有组件，确保 `flutter analyze` 基线无告警：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)

## 2026-02-18

- 记录图片接入本地相册多选与本地路径渲染：美食/小确幸/旅行/羁绊新建页图片选择改为相册多选，图片展示统一支持网络与本地路径；同步补齐 Android 图库权限并接入 image_picker 依赖：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)、[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)、[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)、[pubspec.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/pubspec.yaml)、[AndroidManifest.xml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/android/app/src/main/AndroidManifest.xml)
- 首页日历升级为可切换月份样式，支持点击年月弹出快速选择面板，并支持点击日期选中显示：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 应用名称调整为“人生编年史”，同步更新 Android 与 Web 展示名称：[AndroidManifest.xml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/android/app/src/main/AndroidManifest.xml)、[index.html](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/web/index.html)、[manifest.json](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/web/manifest.json)
- 美食/小确幸详情页接入真实数据与“万物互联”关联展示：详情页改用数据库记录（图片/地点/评分/心情/正文）并根据 `entity_links` 动态渲染关联人物/小确幸/旅行/目标等标签：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
- 数据层补齐详情页单条记录监听：Food/Moment DAO 新增 `watchById` 供详情页实时读取：[food_dao.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/daos/food_dao.dart)、[moment_dao.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/daos/moment_dao.dart)
- 旅行数据真正落库：新增 `travel_records` / `trips` 表并将数据库版本升级至 schemaVersion=3，补齐 v2→v3 迁移创建旅行表：[tables.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/tables.dart)、[app_database.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/app_database.dart)
- 旅行-新建行程/新建游记接入本地落库：创建行程时写入 `trips` 与 `travel_records`；发布游记写入旅行记录并保存标题/正文/心情/图片：[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
- 全站文案统一为“万物互联”：更新美食/小确幸/旅行/目标/羁绊/个人中心相关标题与说明：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)、[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)、[goal_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/goal/presentation/goal_page.dart)、[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)、[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 全局悬浮“+”交互按原型调整：底部弹窗改为 3+3 排列，新增“相遇”入口；“添加朋友”改为跳转到羁绊-朋友档案页；悬浮按钮强制使用圆形样式（更圆润）：[app_shell.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/app/app_shell.dart)
- 全局悬浮“+”补齐“添加朋友”直达新建朋友档案：点击“添加朋友”后自动跳转到新建朋友档案页：[app_shell.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/app/app_shell.dart)
- 首页日程月历修复：删除日历卡右上角浅蓝色半透明“+”；月历从静态半个月样例改为按当前月份动态生成完整 6×7 网格（含跨月补齐），并修复选中日期显示固定为“9”的问题：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 首页日程“整体遮罩感”处理：关闭 `extendBodyBehindAppBar`，避免内容区域被玻璃顶栏半透明覆盖导致视觉上像有遮罩层：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 首页日程顶部入口修复：点击个人头像与设置按钮均可跳转到个人中心（使用 rootNavigator 避免嵌套导航导致无跳转）：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 美食-新建美食记录按原型（`2-4 美食-新建美食记录`）完善：顶部取消/发布、图片九宫格、店名输入、推荐指数、评价/描述、人均消费、相关链接、标签编辑、心愿餐厅开关、地点卡、万物互联索引（关联朋友/旅行/心情）；发布会写入 `food_records`，并将“关联朋友”写入 `entity_links/link_logs`：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
- 小确幸-新建小确幸按原型（`3-3 小确幸-新建小确幸`）补齐：顶部取消/发布、标题+正文输入、标签横滑+自定义标签、照片九宫格、心情横滑、记录时间/地理位置卡、万物互联入口；发布会写入 `moment_records`，并将“关联羁绊/关联美食”写入 `entity_links/link_logs`：[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
- 美食-新建美食记录万物互联补齐旅行/目标选择器，发布时同步写入旅行/目标关联到 `entity_links/link_logs`：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
- 小确幸-新建小确幸接入旅行/目标关联选择器，发布时同步写入旅行/目标关联到 `entity_links/link_logs`：[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
- 美食详情页万物互联补充旅行/目标示例标签，保持关联展示完整性：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
- 小确幸详情页万物互联示例标签补齐目标/旅行/羁绊/美食四类：[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
- 羁绊-新建相遇按原型（`6-4 羁绊-相遇-新建相遇`）重做：标题、相遇对象、日期/地点、心情分享、上传照片、万物互联（关联美食/旅行/目标）；保存会写入 `timeline_events(eventType=encounter)`，并将“相遇对象/关联美食”写入 `entity_links/link_logs`：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 目标-新建目标接入“万物互联”选择器（关联小确幸/美食/羁绊/旅行并显示选中数量）：[goal_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/goal/presentation/goal_page.dart)
- 小确幸详情页补齐“万物互联”说明区块（当前仍为样例数据页）：[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
- 旅行-新建游记补齐“万物互联”分组标题，统一关联区块的视觉层级：[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
- 个人中心-万物互联页改为展示关联日志（最近日志 + 全部日志）：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 美食地图能力补齐并恢复可编译：移除 `amap_flutter_map`（Dart 3.11 下 `hashValues` 不兼容），改用 `amap_flutter`；新建美食地点卡支持跳转地点选择页（搜索地点/点选回填/地图打点/长按选点），详情页地图支持预览与外部导航（高德/百度/腾讯）：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[pubspec.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/pubspec.yaml)
- 个人中心补齐收藏中心与编年史管理页面卡片与列表样式承接：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 个人中心占位页清理未使用的 AppBar actions 参数，修复分析告警基线：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 统一文案为“万物互联”，保持各模块 UI 文案一致：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)、[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 补齐目标新建保存说明，并新增设计文档“未落地清单”梳理当前缺口：[开发设计文档.md](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/%E5%BC%80%E5%8F%91%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3.md)
- 原型与说明文档统一文案为“万物互联”，覆盖编年史前端/原型 HTML/设计文档/开发步骤：[编年史前端.md](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/%E7%BC%96%E5%B9%B4%E5%8F%B2%E5%89%8D%E7%AB%AF.md)、[人生编年史设计.md](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%8F%B2%E8%AE%BE%E8%AE%A1.md)、[开发步骤.md](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4.md)
- 修复目标-关联旅行查询方法与软删除过滤，避免分析报错并确保数据源一致：[goal_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/goal/presentation/goal_page.dart)
- 新增旅行记录统一查询方法 `watchAllActiveTravelRecords` 供多模块复用并保持排序一致：[app_database.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/core/database/app_database.dart)
- 清理旅行页未使用的小组件，消除未引用告警，保持分析基线可通过：[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
- 新增 Android 工程模板并补齐 GitHub Actions APK 构建流水线：[android-apk.yml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/.github/workflows/android-apk.yml)
- 工程：为避免 Drift Web 的 `deprecated_member_use` 信息导致分析失败，补充分析配置并保持基线通过：`flutter analyze` / `flutter test` 已通过：[analysis_options.yaml](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/analysis_options.yaml)

## 2026-02-17

- 旅行模块按前端原型补齐“行程详情 / 新建行程 / 新建游记”界面元素与交互入口（顶部 6 菜单布局不变）：[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
  - 行程详情（对应原型：`4-2 旅行-在路上-旅行行程详情`）：头图 Hero + 底部圆角、渐变遮罩、玻璃拟态返回/收藏/编辑/新增按钮、“一键导出”主按钮、行程信息浮层（天数/地点/标题/日期）
  - 时间线内容：连续竖线 + “第一天/第二天”区块、同行者卡（叠放头像）、记忆卡（大图+时间徽标+标签 Chips）、相册卡（双图宫格+描述）、关联美食卡（横向小卡）
  - 新建行程（对应原型：`4-3 旅行-新建旅行行程`）：玻璃拟态顶部栏（取消/标题/创建）、封面上传虚线框、标题/备注输入、基本信息分组（目的地/日期范围/预算）、同行者横滑邀请区、规划详情（愿望清单开关/预订链接/心愿清单勾选与新增）
  - 新建游记（对应原型：`4-4 旅行-旅行行程-新建旅行游记`）：玻璃拟态顶部栏（取消/发布）、标题/正文输入、九宫格图片区（含虚线添加格）、地点/心情/同行/关联美食/标签等关联区块与“正在关联行程”提示胶囊
  - 跳转入口：行程详情页顶部“+”与右下角悬浮“+”进入新建游记；顶部“编辑”进入新建行程页（作为编辑承接）
- 修复旅行主页“在路上”模块在测试环境下的布局约束异常（`RenderBox was not laid out`），并补齐同行者头像叠放区域的宽度约束，确保 `flutter analyze / flutter test` 基线通过：[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
- 目标模块补齐“目标拆解详情”页原型元素（`5-3 目标-目标拆解详情`）：顶部返回/更多、圆环进度 Hero、季度树结构（完成/进行中/未解锁）、月度目标与每日任务、关联记忆横滑卡片、底部“顺延计划/阶段复盘”操作栏：[goal_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/goal/presentation/goal_page.dart)
- 修复底部 6 菜单下的悬浮“+”按钮层级与交互：将各模块内的 FAB 统一上移到 AppShell 的全局悬浮按钮（淡蓝色），避免被 BottomNavigationBar 覆盖；点击弹出“添加新记录”底部弹窗，可选 美食/小确幸/旅行/目标/朋友 并跳转到对应新建页：[app_shell.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/app/app_shell.dart)

## 2026-02-16

- 初步搭建 6 大模块的“主页/新建/详情”界面骨架，并保持底部 6 菜单布局不变：
  - 美食：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
  - 小确幸：[moment_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/moment/presentation/moment_page.dart)
  - 旅行：[travel_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/travel/presentation/travel_page.dart)
  - 目标：[goal_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/goal/presentation/goal_page.dart)
  - 羁绊（朋友档案/相遇）：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 新增 AI 史官聊天界面（顶部玻璃栏、气泡消息、输入栏快捷指令等）：[ai_historian_chat_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/ai_historian/presentation/ai_historian_chat_page.dart)
- 新增个人中心界面骨架（人生传记卡、功能管理入口等）：[profile_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/profile/presentation/profile_page.dart)
- 日程页补齐入口跳转：AI史官按钮进入聊天页、设置按钮进入个人中心：[home_schedule_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/home_schedule/presentation/home_schedule_page.dart)
- 修复 AI 史官页面 TopBar 的布局结构错误（Positioned 只能作为 Stack 子节点），避免运行时报错。
- 美食主页补齐“美食记录/心愿清单”分段切换，并新增心愿清单详情页（评分/标签/备注/万物互联占位 + 底部操作栏）：[food_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/food/presentation/food_page.dart)
- 羁绊模块补齐页面跳转与承接页：朋友档案卡片→档案详情（档案卡 + AI 洞察入口 + 共同回忆轴）；相遇卡片→相遇详情；顶部“+”与悬浮“+”进入新建相遇：[bond_page.dart](file:///d:/trae/%E4%BA%BA%E7%94%9F%E7%BC%96%E5%B9%B4%E5%9B%BD%E9%99%85/life_chronicle/lib/features/bond/presentation/bond_page.dart)
- 为兼容当前 Flutter SDK，将页面内 `withOpacity(...)` 统一替换为 `withValues(alpha: ...)`；并清理未使用的 UI 小组件/参数，`flutter analyze` + `flutter test` 已通过。

## 2026-02-14

- 新增 Drift 三张实体表：food_records、moment_records、friend_records（软删除字段、时间字段统一为 DateTime）。
- AppDatabase 升级到 schemaVersion=2，并补充从 v1→v2 的迁移步骤（创建新增三表）。
- 新增 DAO：FoodDao、MomentDao、FriendDao、LinkDao；实现 Link 的新增/删除/查询（含 link_logs 追溯）。
- 修复 Drift 查询排序与主题配置的兼容性问题（NullsOrder、CardThemeData、withValues）。
- 增加 Widget Test 的网络图片桩，避免测试环境网络请求导致失败；flutter analyze / flutter test 已通过。
- flutter build web 已通过（可作为当前环境的“编译验证”基线）。
- Flutter 工具链解压可用，flutter doctor 已跑通；当前环境仍缺少 Windows 符号链接权限，Windows 桌面构建可能被阻塞（需启用“开发者模式”或以管理员权限运行）。
